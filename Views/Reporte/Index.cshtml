@{
    ViewData["Title"] = "Device Page";
}

<link href="@Url.Content("~/css/reporte.css")" rel="stylesheet" type="text/css" />

<script type="text/javascript" src="@Url.Content("~/js/calendar.min.js")"></script>
<!-- Calendar picker -->
<link href="@Url.Content("~/css/calendar.css")" rel="stylesheet" type="text/css" />

<!-- <ul class="breadcrumb">
    <li class="breadcrumb-item"><a href="#">HOME</a></li>
    <li class="breadcrumb-item active">REPORTES</li>
</ul> -->
<div class="container-fluid">

    <div class="col-md-12 card-deck">


    </div>


    <!--   Querys  -->
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <form class="form-inline" action="">
                    <h2> Rango del Reporte </h2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label for="repoInitTime">Fecha inicial: </label>
                    <input type="text" class="calendar" id="repoInitTime" name="repoInitTime"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label for="repoEndTime">Fecha final: </label>
                    <input type="text" class="calendar" id="repoEndTime" name="repoEndTime"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <a class="btn btn-primary" id ="consultBtn"> Consultar </a>
                </form>
            </div>
            <div class="card-body">
                <div class="reporte view" id="reporte">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header ">
                                    <h4 class="card-title">Enrolados</h4>
                                </div>
                                <div class="card-body">
                                    <div class="stat-widget-one">
                                        <div class="stat-icon dib"><i class="ti-money text-success border-success"></i></div>
                                        <div class="stat-content dib" style="text-align:center">
                                            <!-- <div class="stat-text">Total Asistencias Registradas</div> -->
                                            <div class="stat-digit" id="totalEnrolados">  </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        @* <div class="col-md-3">
                            <div class="card">
                                <div class="card-header ">
                                    <h4 class="card-title">Rechazos</h4>

                                </div>
                                <div class="card-body">
                                    <div class="stat-widget-one">
                                        <div class="stat-icon dib"><i class="ti-money text-success border-success"></i></div>
                                        <div class="stat-content dib" style="text-align:center">
                                            <!-- <div class="stat-text">Alumnos Atendidos</div> -->
                                            <div class="stat-digit" id="reconocimientosDia"> </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> *@
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header ">
                                    <h4 class="card-title">Reconocimientos</h4>
                                </div>
                                <div class="card-body">
                                    <div class="stat-widget-one">
                                        <div class="stat-icon dib"><i class="ti-money text-success border-success"></i></div>
                                        <div class="stat-content dib" style="text-align:center">
                                            <div class="stat-digit" id="totalReconocimientos"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header ">
                                    <h4 class="card-title">Alertas</h4>

                                </div>
                                <div class="card-body">
                                    <div class="stat-widget-one">
                                        <div class="stat-icon dib"><i class="ti-money text-success border-success"></i></div>
                                        <div class="stat-content dib" style="text-align:center">
                                            <!-- <div class="stat-text">Total Asistencias Registradas</div> -->
                                            <div class="stat-digit" id="totalAlertas"> </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    

                    

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card ">
                                <div class="card-header ">
                                    <h4 class="card-title">Soporte Enrolamiento</h4>
                                    <p class="card-category">Registro de enrolamiento del periodo</p>
                                </div>
                                <div class="card-body " style="height:450px;overflow:auto;">
                                    <!-- <div id="columnwrapper6" style="width:100%; margin-bottom: 20px;"></div>
                                    <?php //echo $this->Highcharts->render($chartName6); ?> -->
                                    <table id="tblNiveles" class="table table-vcenter table-responsive table-condensed table-bordered display">
                                        <thead>
                                            <tr>
                                                <th>Fecha</th>
                                                <th>Doc</th>
                                                <th>Nombre</th>
                                                <th>Empresa</th>
                                                <th>Foto?</th>
                                            </tr>
                                        </thead>
                                        <tbody id="soporteEnrolados">
                                        </tbody>

                                    </table>
                                </div>

                                <div class="card-footer ">
                                    <hr>
                                    
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div id="walkins">
                                <div class="card ">
                                    <div class="card-header ">
                                        <h4 class="card-title">Distribucion Reconocimientos</h4>
                                        <p class="card-category">Registro de reconocimientos del periodo</p>
                                    </div>
                                    <div class="card-body " style="height:450px;overflow:auto;">
                                        <table id="tblRecoDisp" class="table table-vcenter table-responsive table-condensed table-bordered display">
                                            <thead>
                                                <tr>
                                                    <th>Fecha</th>
                                                    <th>Ciudad</th>
                                                    <th>Puerta</th>
                                                    <th>Disp.</th>
                                                    <th>Recon.</th>
                                                    <th>Personas</th>
                                                    <th>Alertas</th>
                                                </tr>
                                            </thead>
                                            <tbody id="distribReco">
                                            </tbody>

                                        </table>
                                        
                                    </div>
                                    <div class="card-footer ">
                                        <hr>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 col-md-12">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card ">
                                        <div class="card-header ">
                                            <h4 class="card-title">Soporte Reconocimientos</h4>
                                            <p class="card-category">Registro de personas reconocidas</p>
                                        </div>
                                        <div class="card-body " style="height:450px;overflow:auto;">
                                            <div id="columnwrapper" style="width:100%; margin-bottom: 20px;"></div>
                                            <table id="tblRecos" class="table table-vcenter table-responsive table-condensed table-bordered display">
                                            <thead>
                                                <tr>
                                                    <th>Fecha</th>
                                                    <th>Ciudad</th>
                                                    <th>Puerta</th>
                                                    <th>Disp.</th>
                                                    <th>Doc</th>
                                                    <th>Nombre</th>
                                                    <th>Empresa</th>
                                                    <th>Sim</th>
                                                    <th>Temp</th>
                                                </tr>
                                            </thead>
                                            <tbody id="soporteReconocimientos">
                                            </tbody>

                                        </table>
                                        </div>

                                        <div class="card-footer ">
                                            <hr>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
        
                    </div>

                    <div class="row">
                        <div class="col-lg-12 col-md-12">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card ">
                                        <div class="card-header ">
                                            <h4 class="card-title">Soporte Alertas</h4>
                                            <p class="card-category">Registro de alertas por personas</p>
                                        </div>
                                        <div class="card-body " style="height:450px;overflow:auto;">
                                            <div id="columnwrapper" style="width:100%; margin-bottom: 20px;"></div>
                                            <table id="tblRecos" class="table table-vcenter table-responsive table-condensed table-bordered display">
                                            <thead>
                                                <tr>
                                                    <th>Fecha</th>
                                                    <th>Ciudad</th>
                                                    <th>Puerta</th>
                                                    <th>Disp.</th>
                                                    <th>Doc</th>
                                                    <th>Nombre</th>
                                                    <th>Empresa</th>
                                                    <th>Sim</th>
                                                    <th>Temp</th>
                                                </tr>
                                            </thead>
                                            <tbody id="soporteAlertas">
                                            </tbody>

                                        </table>
                                        </div>

                                        <div class="card-footer ">
                                            <hr>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
        
                    </div>

                

                    <div class="row card-deck">
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="card-header ">
                                        <h4 class="card-title">Consulta de datos</h4>
                                        <select id="bind_device_id_select">
                                            <option value="" data-token=""> Seleccione </option>

                                            @foreach (dynamic device in ViewBag.Devices)
                                            {
                                                <option value="@device.dev_id">@device.tag</option>
                                            }
                                        </select>
                                        <br>
                                        <br>
                                        <label for="Name">Nombre: </label>
                                        <input type="text" id="ecp_name" name="Name"><br><br>
                                        <label for="Temp">Temperatura mínima: </label>
                                        <input type="text" id="ecp_temp_min" name="Temp"><br><br>
                                        <label for="Temp">Temperatura máxima: </label>
                                        <input type="text" id="ecp_temp_max" name="Temp"><br><br>
                                        <label for="devID">ID dispositivo: </label>
                                        <input type="text" id="ecp_dev_id" name="devID"><br><br>
                                        <label for="userID">ID usuario: </label>
                                        <input type="text" id="ecp_user_id" name="userID"><br><br>
                                        <label for="initTime">Fecha inicial: </label>
                                        <input type="text" class="calendar" id="init" name="initTime"><br><br>
                                        <label for="endTime">Fecha final: </label>
                                        <input type="text" class="calendar" id="end" name="endTime"><br><br>
                                        <label for="msk">Mascarilla: </label>
                                        <input type="text" id="mask_en" name="msk"><br><br>
                                        <label for="rec">Reconocidos: </label>
                                        <input type="text" id="rec_en" name="rec"><br><br>
                                        <div class="input-group-append"><button class="btn btn-success" id="Query" style="width:165px;">Enviar</button></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="card" style="max-height:600px;">
                                <div class="card-header">
                                    <h4 class="card-title">Datos obtenidos</h4>
                                </div>
                                <div class="card-body" id="dynReport" style="min-height:550px;overflow:auto;">
                                    <table id="tblRecos" class="table table-vcenter table-responsive table-condensed table-bordered display">
                                            <thead>
                                                <tr>
                                                    <th>Fecha</th>
                                                    <th>Disp</th>
                                                    <th>Doc</th>
                                                    <th>Nombre</th>
                                                    <th>Temp</th>
                                                    <th>Masc</th>
                                                    <th>Match</th>
                                                    <th>Similar</th>
                                                    <th>imageUrl</th>
                                                </tr>
                                            </thead>
                                            <tbody id="soporteEventos">
                                            </tbody>

                                        </table>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">CONSULTAS</h4>
                <br>
                <select id="bind_device_id_select">
                    <option value="" data-token=""> Seleccione </option>

                    @foreach (dynamic device in ViewBag.Devices)
                    {
                        <option value="@device.dev_id">@device.tag</option>
                    }
                </select> <div class="input-group-append"></div>
                <br>
                <div class="row">
                    <form>
                        <h5>Consulta por páginas</h5>

                        <div class="input-group">
                            <div class="input-group-prepend"><span class="input-group-text"> Cantidad de páginas </span></div><input autocomplete="off" type="text" class="form-control" id="page" />
                            <div class="input-group-append"><button class="btn btn-success" id="query_pages" style="width:165px;">REALIZAR CONSULTA</button></div>
                        </div>

                        <div class="row">

                        </div>
                        <h5>Consulta por lote</h5>

                        <div class="input-group">
                            <div class="input-group-prepend"><span class="input-group-text"> ID del lote </span></div><input autocomplete="off" type="text" class="form-control" id="batch" />
                            <div class="input-group-append"><button class="btn btn-success" id="query_batch" style="width:165px;">CONSULTAR LOTE</button></div>
                        </div>

                        <div class="row">

                        </div>
                        <h5>Consulta por usuario</h5>

                        <div class="input-group">
                            <div class="input-group-prepend"><span class="input-group-text"> ID del usuario </span></div><input autocomplete="off" type="text" class="form-control" id="user" />
                            <div class="input-group-append"><button class="btn btn-success" id="query_user" style="width:165px;">CONSULTAR USUARIO</button></div>
                        </div>
                        <div class="row">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <
    <!-- Carga las librerias de MQTT js -->
    <!--  <script src="~/js/mqtt.js"></script> -->

    <script src="~/js/signalr/dist/browser/signalr.js"></script>
    <script src="~/js/chat.js"></script>
    <script>
        
        var result = [];
        var device_tkn;
        var eventosDia, reconocimientosDia, personasDia;

        $('#query_pages').on('click',queryPages);
        $('#query_batch').on('click', queryBatch);
        $('#query_user').on('click', queryUser);
        $('#bind_device_id_select').on('change', changeDevice);

        $('#Query').on('click', reportQuery);

        function formatDate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2) 
                month = '0' + month;
            if (day.length < 2) 
                day = '0' + day;

            return [year, month, day].join('-');
        }

        $(function () {
            var calendarRepoInit = new CalendarPopup('#repoInitTime', {
                format: 'YYYY-MM-DD',
                dayOfWeekStart: 1,
                locale: 'es',
            });
            var today = new Date();

            $('#repoInitTime').val(formatDate(today));


            var calendarRepoEnd = new CalendarPopup('#repoEndTime', {
                format: 'YYYY-MM-DD',
                dayOfWeekStart: 1,
                locale: 'es',
            });
            $('#repoEndTime').val(formatDate(today));

            var calendarInit = new CalendarPopup('#init', {
                format: 'YYYY-MM-DD',
                dayOfWeekStart: 1,
                locale: 'es',
            });
            var calendarEnd = new CalendarPopup('#end', {
                format: 'YYYY-MM-DD',
                dayOfWeekStart: 1,
                locale: 'es',
            });

            getReport($('#repoInitTime').val(),$('#repoEndTime').val())
        });

        $("#consultBtn").on('click', function(){
            getReport($('#repoInitTime').val(),$('#repoEndTime').val())
        })
        
        $(document).ready(function(){
            reportQuery();
            $("eventosDia").html = eventosDia.lenght();
            $("reconocimientosDia").html = reconocimientosDia.lenght();
           
        });

        function getReport(start, end) {
            getTotalEnroll(start, end)
            getTotalReco(start, end)
            getDistReco(start, end)
            getTotalAlertas(start, end)
        }

        function getTotalEnroll(start, end) {
            data = {
                start_date: start,
                end_date: end
            };

            jQuery.ajax({
                type: "GET",
                format: "json",
                url: '@Url.Action("getRepoEnroll", "Reporte")',
                dataType: "json",
                data: data,
                success: function (data) {
                    
                    console.log(data);
                    result = data.data;
                    
                    // Se muestra el total
                    $("#totalEnrolados").empty();                    
                    $("#totalEnrolados").html(data.count);

                    html = "";
                    $("#soporteEnrolados").empty();
                    $("#soporteEnrolados").append(html);
                    $.each(data.data, function (index, value) {
                        // here you can do your magic                        
                        html = "<tr><td>" + value.fecha + "</td><td>" + value.docId +  "</td><td>" + value.name +  "</td><td>" + value.empresa +  "</td><td>" + value.hasPhoto +  "</td></tr>"
                        //console.log(html);
                        $("#soporteEnrolados").append(html);
                    });
        

                }
            });

        }

        function getTotalReco(start, end) {
            data = {
                start_date: start,
                end_date: end
            };

            jQuery.ajax({
                type: "GET",
                format: "json",
                url: '@Url.Action("getSopoRecoDia", "Reporte")',
                dataType: "json",
                data: data,
                success: function (data) {
                    
                    console.log(data);
                    result = data.data;
                    
                    // Se muestra el total
                    $("#totalReconocimientos").empty();                    
                    $("#totalReconocimientos").html(data.count);

                    html = "";
                    $("#soporteReconocimientos").empty(); 
                    $("#soporteReconocimientos").append(html);
                    $.each(data.data, function (index, value) {
                        // here you can do your magic                        
                        html = "<tr><td>" + value.dateTime + "</td><td>" + value.ciudad + "</td><td>" + value.sitio + "</td><td>" + value.devId + "</td><td>" + value.docId +  "</td><td>" + value.name +  "</td><td>" + value.empresa +  "</td><td>" + value.similar.toFixed(2) +  "</td><td>" + value.temperature.toFixed(2) + "</td></tr>"
                        //console.log(html);
                        $("#soporteReconocimientos").append(html);
                    });
        

                }
            });

        }

        function getDistReco(start, end) {
            data = {
                start_date: start,
                end_date: end
            };

            jQuery.ajax({
                type: "GET",
                format: "json",
                url: '@Url.Action("getRecoDia", "Reporte")',
                dataType: "json",
                data: data,
                success: function (data) {
                    
                    console.log(data);
                    result = data.data;
            

                    html = "";
                    $("#distribReco").empty(); 
                    $("#distribReco").append(html);
                    $.each(data.data, function (index, value) {
                        // here you can do your magic                        
                        html = "<tr><td>" + value.fecha + "</td><td>" + value.ciudad + "</td><td>" + value.sitio + "</td><td>" + value.devId + "</td><td>" + value.recos +  "</td><td>" + value.personas +  "</td><td>" + value.alertas + "</td></tr>"
                        //console.log(html);
                        $("#distribReco").append(html);
                    });
        

                }
            });

        }

        function getTotalAlertas(start, end) {
            data = {
                start_date: start,
                end_date: end,
                tmin: 37.3
            };

            jQuery.ajax({
                type: "GET",
                format: "json",
                url: '@Url.Action("getSopoRecoDia", "Reporte")',
                dataType: "json",
                data: data,
                success: function (data) {
                    
                    console.log(data);
                    result = data.data;
                    
                    // Se muestra el total
                    $("#totalAlertas").empty();                    
                    $("#totalAlertas").html(data.count);

                    html = "";
                    $("#soporteAlertas").append(html);
                    $.each(data.data, function (index, value) {
                        // here you can do your magic                        
                        html = "<tr><td>" + value.dateTime + "</td><td>" + value.ciudad + "</td><td>" + value.sitio + "</td><td>" + value.devId + "</td><td>" + value.docId +  "</td><td>" + value.name +  "</td><td>" + value.empresa +  "</td><td>" + value.similar.toFixed(2) +  "</td><td>" + value.temperature.toFixed(2) + "</td></tr>"
                        //console.log(html);
                        $("#soporteAlertas").append(html);
                    });
        

                }
            });

        }


        function reportQuery() {
            let todayDate = new Date().toLocaleString();           

            console.log(todayDate);
            // Total eventos del dia

            let initDev = null;
            let initName = null;
            let initTempMin = null;
            let initTempMax = null;
            let initDate = null;
            let endDate = null;
            let initHasId = null;

            if(typeof device_id !== 'undefined') {
                initDev = (device_id > 0) ? device_id : null;
            } else {
                initDev = null;
            }
            

            //Nombre
            if ($('#ecp_name').val() != 0) {
                console.log("El nombre a enviar es: ")
                console.log($('#ecp_name').val());
                initName = $('#ecp_name').val();
            }

            //Temperatura minima 
            if ($('#ecp_temp_min').val() != 0) {
                console.log("La temperatura mínima a enviar es: ")
                console.log($('#ecp_temp_min').val());
                initTempMin = $('#ecp_temp_min').val();
            }

            //Temperatura minima 
            if ($('#ecp_temp_max').val() != 0) {
                console.log("La temperatura máxima a enviar es: ")
                console.log($('#ecp_temp_max').val());
                initTempMax = $('#ecp_temp_max').val();
            }

            //Fecha inicial
            if ($('#init').val() != 0) {
                console.log("El valor del calendario es: ")
                console.log($('#init').val());
                initDate = $('#init').val();
            }

            //Fecha final
            if ($('#end').val() != 0) {
                console.log("El valor del calendario es: ")
                console.log($('#end').val());
                endDate = $('#end').val();
            }
           

            data={
                    device_id: initDev,
                    name: initName,
                    tmin: initTempMin,
                    tmax: initTempMax,
                    start_date: initDate,
                    end_date: endDate,
                    hasId: 1,

                };
            
            eventosDia = getData(data);

        }

        function getData(data) {
            // var t_min= $("#tmin").value();


            jQuery.ajax({
                type: "GET",
                format: "json",
                url: '@Url.Action("getEventos", "Reporte")',
                dataType: "json",
                data: data,
                success: function (data) {
                    
                    result = data;
                    
                    //result = jQuery.parseJSON(data);

                    //console.log(result);
                    /*
                     * for (var [key, value] of Object.entries(data)) {
                        //console.log(key + ' ' + value); // "a 5", "b 7", "c 9"
                        console.log(value);
                        $("#reporte").append("<li>" + value.name + "</li>");
                    }
                    */
                    html = "";
                    $("#soporteEventos").empty();
                    $("#soporteEventos").append(html);
                    $.each(data.data, function (index, value) {
                        // here you can do your magic                        
                        html = "<tr><td>" + value.registerTime + "</td><td>" + value.devId + "</td><td>" + value.userId + "</td><td>" + value.name + "</td><td>" + value.temperature.toFixed(2) +  "</td><td>" + value.mask +  "</td><td>" + value.matched +  "</td><td>" + value.similar.toFixed(2) +  "</td><td><a href='" + value.imageUrl.substring(7) + "' target='_blank'> Ver Imagen </a></td></tr>"
                        //console.log(html);
                        $("#soporteEventos").append(html);
                    });



                }
            });
        }


    /* device basic configuration example
    {
        "mqtt_cmd":1,
        "mqtt_operate_id":1,
        "device_token":"1057628122",
        "device_id":"7101389947744",
        "tag":"platfrom define",
        "basic_config":
        {
            "dev_name":"12315456445864",
            "dev_pwd":"YWRtaW4=",
            "sync_server_pts_en":true,
            "server_cur_pts":"2020/05/18 11:07"
        }
    }

    */

    // Se dispara cuando se selecciona una tableta de la lista desplegable
    function changeDevice() {
        device_id = $(this).val();
        console.log("Device_id : " + device_id);
        $.get("/Device/getDeviceToken?device_id=" + device_id, function (data) {
            device_tkn = data.token;
            device_tag = data.tag;
            console.log("Data : ")
            console.log(data);
            console.log("Dev Tkn : " + device_tkn);
            console.log("Device_tag : " + device_tag);
        });

    }

    function queryPages() {
        var dev_id = "7101076854037";
        var dev_tag = "DEV02";
        var pages = parseInt($('#page').val());
        console.log(dev_id, dev_tag);
        jsonMsg =
            {
				mqtt_cmd:1,
                mqtt_operate_id: 7,
                device_token: device_tkn,
                device_id: dev_id,
                tag: dev_tag,
			    piclib_manage:4,
				page: pages
        }
        ;
        jsonMsg = JSON.stringify(jsonMsg);
        console.log(jsonMsg);
        $.ajax({
            type: "GET",
            url: '@Url.Action("publishMQTT", "Device")',
            dataType: "json",
            data:{
                topic:"SubscribeTest",
                msg: jsonMsg,
            },
            async: false,
            success: function(data) {

                var jsonPretty = "<pre>" + jsonMsg + "</pre>";
                $('#mqtt_send').html(
                    jsonPretty
                )
            },
            error: function() {
                console.log("Error querying pages");
            }
        });
    }

    /* device basic configuration example
    {
            "mqtt_cmd": 1,
            "mqtt_operate_id": 7,
            "device_token": "1514348271",
            "device_id": "7101389947744",
            "tag": "platfrom define",
            "piclib_manage": 5,
            "param": {
                "lib": [
                    {
                        "lib_id": "8"
                    },
                    {
                        "lib_id": "9"
                    }
                ]
            }
        }

    */

        function queryBatch() {
        var dev_id = "7101076854037";
        var dev_tag = "DEV02";
        var batchs = $('#batch').val()
        console.log(dev_id, dev_tag);
        jsonMsg =
            {
				mqtt_cmd:1,
                mqtt_operate_id: 7,
                device_token: device_tkn,
                device_id: dev_id,
                tag: dev_tag,
			    piclib_manage:5,
                param: {

                    lib:
                    [
                    {
                        lib_id: batchs
                    }
                    ]
                }
            }
        ;
        jsonMsg = JSON.stringify(jsonMsg);
        console.log(jsonMsg);
        $.ajax({
            type: "GET",
            url: '@Url.Action("publishMQTT", "Device")',
            dataType: "json",
            data:{
                topic:"SubscribeTest",
                msg: jsonMsg,
            },
            async: false,
            success: function(data) {

                var jsonPretty = "<pre>" + jsonMsg + "</pre>";
                $('#mqtt_send').html(
                    jsonPretty
                )
            },
            error: function() {
                console.log("Error querying batchs");
            }
        });
        }

    /* query individual or multiple user face database information
  {
				"mqtt_cmd":1,
				"mqtt_operate_id":7,
				"device_token":"1057628122",
				"device_id":"7101389947744",
				"tag":"platfrom define",
				"piclib_manage":6,
				"param":{
					"users":[
						{
							"user_id":"1"
						},
						{
							"user_id":"2"
						}
					]
				}
			}


    */

        function queryUser() {
        var dev_id = "7101076854037";
        var dev_tag = "DEV02";
        var users = $('#user').val()
        console.log(dev_id, dev_tag);
        jsonMsg =
            {
				mqtt_cmd:1,
                mqtt_operate_id: 7,
                device_token: device_tkn,
                device_id: dev_id,
                tag: dev_tag,
			    piclib_manage:6,
                param:
                {
                    users:
                    [
                    {
                        user_id: users
                    }
                    ]

                }
            }
        ;
        jsonMsg = JSON.stringify(jsonMsg);
        console.log(jsonMsg);
        $.ajax({
            type: "GET",
            url: '@Url.Action("publishMQTT", "Device")',
            dataType: "json",
            data:{
                topic:"SubscribeTest",
                msg: jsonMsg,
            },
            async: false,
            success: function(data) {

                var jsonPretty = "<pre>" + jsonMsg + "</pre>";
                $('#mqtt_send').html(
                    jsonPretty
                )
            },
            error: function() {
                console.log("Error querying users");
            }
        });
        }
    </script>

</div>




